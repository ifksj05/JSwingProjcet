drop database if exists Institute;
create database if not exists Institute charset utf8;
use Institute;

create table permission (
	pID int auto_increment primary key,
    detail text
);

insert into permission values(null, 'manager');
insert into permission values(null, 'staff');

create table admin (
	Id varchar(20) not null primary key,
    Passwd varchar(20),
    Name varchar(20) not null,
    pID int not null,
    failCnt int,
    allowLoginDate datetime,
	constraint foreign key (pID) references permission(pid)
);

create table course (
	CourseName varchar(30) not null primary key,
    TeachName varchar(20) not null,
    Price int
);

create table member (
	MemberCode int auto_increment,
    MemberName varchar(30),
    Phone varchar(20),
    Address varchar(30),
    RegDate timestamp default now(),
    primary key (MemberCode, MemberName)
);

create table coursemanage (
	RegisterCode int auto_increment primary key,
    MemberCode int,
    MemberName varchar(30),
    CourseName varchar(30),
    CoursePrice int,
    Period int,
    RegPrice int,
    crregdate date,
    constraint foreign key (MemberCode, MemberName) references Member(MemberCode, MemberName) on delete cascade on update cascade,
    constraint foreign key (CourseName) references course(CourseName) on delete cascade on update cascade
);